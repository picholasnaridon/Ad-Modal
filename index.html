<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>
    <script>
      function loadLibraries() {
        // load GPT library
        var s = document.createElement("script");
        s.src = "https://www.googletagservices.com/tag/js/gpt.js";
        s.type = "text/javascript";
        s.async = true;
        document.getElementsByTagName("head")[0].appendChild(s);

        // load Prebid library
        // this is the "kitchen sink" version of Prebid for testing
        // we will send you a custom stripped-down version that has
        // a smaller footprint for production
        var s = document.createElement("script");
        s.src = "//acdn.adnxs.com/prebid/not-for-prod/1/prebid.js";
        s.type = "text/javascript";
        s.async = true;
        document.getElementsByTagName("head")[0].appendChild(s);

        // the ad size we want to render
        var sizes = [970, 250];

        // the ad networks that are bidding
        // currently 'AppNexus', but more IDs follow here
        var adUnits = [
          {
            code: "ad-1",
            mediaTypes: {
              banner: {
                sizes: sizes
              }
            },
            bids: [
              {
                bidder: "appnexus",
                params: {
                  placementId: 13144370
                }
              }
            ]
          }
        ];

        // this initiates PrebidJS
        window.pbjs = window.pbjs || {};
        pbjs.que = pbjs.que || [];
        pbjs.que.push(function() {
          pbjs.addAdUnits(adUnits);
        });

        // this initiates the Google Ad library called "GPT"
        window.googletag = window.googletag || {};
        googletag.cmd = googletag.cmd || [];

        // GPT setup
        googletag.cmd.push(function() {
          googletag
            .defineSlot("/33049290/PIANO", sizes, "ad-1")
            .addService(googletag.pubads());
          googletag.pubads().setCentering(true);
          googletag.pubads().collapseEmptyDivs();
          googletag.pubads().enableSingleRequest();
          googletag.pubads().disableInitialLoad();
          googletag.pubads().setTargeting("interests", ["cars", "trains"]);
          googletag.pubads().setTargeting("segments", ["alpha-1", "beta-2"]);
          googletag.pubads().setTargeting("url", "http://example.com");
          googletag.enableServices();
        });

        // OPTIONAL
        // setup a hook to be notified when the ad has rendered
        googletag.cmd.push(function() {
          googletag
            .pubads()
            .addEventListener("slotRenderEnded", function(event) {
              if (event.isEmpty) {
                // do something when no ads are available
                // this branch can't happen if we setup house ads
                return;
              }
              // optionally do something with the slot
              var slot = event.slot;
              var divId = slot.getSlotElementId();
              var domElement = document.getElementById(divId);
              console.log(domElement);
            });
        });

        // OPTIONAL
        // setup a hook to be notified when a prebid bid is received
        // this object will contain the CPM of the bid (if any)
        pbjs.que.push(function() {
          pbjs.onEvent("bidResponse", function(event) {
            console.log(event);
          });
        });
      }

      function showAd(selector) {
        // place our ad after the given selector
        var div = document.createElement("div");
        div.setAttribute("id", "ad-1");
        document.querySelectorAll(selector)[0].appendChild(div);

        // configureable timeout
        var PREBID_TIMEOUT = 1000;
        var FAILSAFE_TIMEOUT = 3000;

        // callback when header bidding ends or timeout occurs
        // the "refresh()" function is what REALLY shows the ad
        function initAdserver() {
          if (pbjs.initAdserverSet) return;
          pbjs.initAdserverSet = true;
          googletag.cmd.push(function() {
            pbjs.que.push(function() {
              var slots = googletag
                .pubads()
                .getSlots()
                .filter(function(slot) {
                  return slot.getSlotElementId() == "ad-1";
                });
              pbjs.setTargetingForGPTAsync();
              googletag.pubads().refresh(slots);
            });
          });
        }

        // initiates the header bidding request to
        // each ad network asking for their best bid
        pbjs.que.push(function() {
          pbjs.requestBids({
            bidsBackHandler: initAdserver,
            timeout: PREBID_TIMEOUT
          });
        });

        // catchall timeout, to make sure we show an ad, even
        // if header bidding fails or hits an error
        setTimeout(function() {
          initAdserver();
        }, FAILSAFE_TIMEOUT);
      }
      loadLibraries();
      
    </script>
  </head>

  <body>
    <script>
      var addStyles = () => {
        var styleNode = document.createElement("div");
        styleNode.innerHTML = ` <style>
                                  .modal {
                                    display: block;
                                    position: fixed;
                                    z-index: 1;
                                    left: 0;
                                    top: 0;
                                    width: 100%;
                                    height: 100%;
                                    overflow: auto;
                                    background-color: rgb(0,0,0);
                                    background-color: rgba(0,0,0,0.4);
                                  }
            
                                  .modal-content {
                                    background-color: #fefefe;
                                    margin: 15% auto;
                                    padding: 20px;
                                    border: 1px solid #888;
                                    width: 90%;
                                  }
              
                                  .close {
                                    color: #aaa;s
                                    float: right;
                                    font-size: 28px;
                                    font-weight: bold;
                                  }
      								    	  </style>`;
        document.body.appendChild(styleNode);
      };

      var addContent = () => {
        var modal = document.createElement(`div`);
        modal.className = "modal";
        modal.innerHTML = `<div class="modal-content" style=>
                            <span class="close">&times;</span>
                            <p>Some text in the Modal..</p>
                            <div id='ad-container'></div>
                          </div>`;

        document.body.appendChild(modal);
        closeButton = document.querySelector(".close");

        closeButton.addEventListener("click", function() {
          modal.style.display = "none";
        });
      };

      var logPianoConversion = () => {
        console.log("Conversion");
      };

      var createModal = function() {
        addStyles();
        addContent();
        showAd("#ad-container");
      };
    </script>
    <h2>Demo</h2>
    <p>
      Lorem ipsum dolor, sit amet consectetur adipisicing elit. Expedita,
      voluptate esse quam adipisci, fugiat eos aperiam asperiores sit doloremque
      tempora veritatis eius, exercitationem qui et totam nesciunt quo. Non,
      ipsum.
    </p>
    <p>
      Lorem ipsum dolor, sit amet consectetur adipisicing elit. Expedita,
      voluptate esse quam adipisci, fugiat eos aperiam asperiores sit doloremque
      tempora veritatis eius, exercitationem qui et totam nesciunt quo. Non,
      ipsum.
    </p>
    <p>
      Lorem ipsum dolor, sit amet consectetur adipisicing elit. Expedita,
      voluptate esse quam adipisci, fugiat eos aperiam asperiores sit doloremque
      tempora veritatis eius, exercitationem qui et totam nesciunt quo. Non,
      ipsum.
    </p>

    <script>
      (function(src) {
        var a = document.createElement("script");
        a.type = "text/javascript";
        a.async = true;
        a.src = src;
        var b = document.getElementsByTagName("script")[0];
        b.parentNode.insertBefore(a, b);
      })(
        "https://sandbox.tinypass.com/xbuilder/experience/load?aid=oiGmjC8JwK"
      );
    </script>
  </body>
</html>
